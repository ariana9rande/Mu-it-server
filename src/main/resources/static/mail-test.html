<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì´ë©”ì¼ ì¸ì¦ í…ŒìŠ¤íŠ¸</title>
  <style>
    body {
      font-family: sans-serif;
      max-width: 500px;
      margin: 50px auto;
    }
    input, button {
      padding: 10px;
      margin-top: 10px;
      width: 100%;
      font-size: 16px;
    }
    #result {
      margin-top: 20px;
      white-space: pre-wrap;
      background: #f4f4f4;
      padding: 10px;
      border-radius: 8px;
    }
    .section {
      margin-bottom: 30px;
    }
  </style>
</head>
<body>
<h1>ì´ë©”ì¼ ì¸ì¦ í…ŒìŠ¤íŠ¸</h1>

<div class="section">
  <input type="email" id="email" placeholder="ì´ë©”ì¼ ì£¼ì†Œ ì…ë ¥" />
  <button onclick="sendAuthCode()">1ë‹¨ê³„: ì¸ì¦ë²ˆí˜¸ ì „ì†¡</button>
</div>

<div class="section">
  <input type="text" id="code" placeholder="ì¸ì¦ë²ˆí˜¸ ì…ë ¥ (6ìë¦¬)" />
  <button onclick="verifyCode()">2ë‹¨ê³„: ì¸ì¦ë²ˆí˜¸ ê²€ì¦</button>
</div>

<div id="result"></div>

<script>
  const API_BASE = 'http://localhost:8080/api/auth'; // í•„ìš” ì‹œ ìˆ˜ì •

  async function sendAuthCode() {
    const email = document.getElementById('email').value;
    const resultDiv = document.getElementById('result');
    resultDiv.textContent = 'â³ ì¸ì¦ ì½”ë“œ ì „ì†¡ ì¤‘...';

    try {
      const res = await fetch(`${API_BASE}/email/send`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: email
      });

      const text = await res.text();

      if (res.ok) {
        resultDiv.textContent = `âœ… ì¸ì¦ ì½”ë“œê°€ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.\nì‘ë‹µ: ${text}`;
      } else {
        resultDiv.textContent = `âŒ ì˜¤ë¥˜ ë°œìƒ (HTTP ${res.status})\n${text}`;
      }
    } catch (err) {
      resultDiv.textContent = `ğŸš¨ ìš”ì²­ ì‹¤íŒ¨: ${err.message}`;
    }
  }

  async function verifyCode() {
    const email = document.getElementById('email').value;
    const code = document.getElementById('code').value;
    const resultDiv = document.getElementById('result');
    resultDiv.textContent = 'â³ ì¸ì¦ë²ˆí˜¸ ê²€ì¦ ì¤‘...';

    try {
      const res = await fetch(`${API_BASE}/email/verify`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          email: email,
          code:  code
        })
      });

      const text = await res.text();

      if (res.ok) {
        resultDiv.textContent = `âœ… ì¸ì¦ ì„±ê³µ!\nì‘ë‹µ: ${text}`;
      } else {
        resultDiv.textContent = `âŒ ì¸ì¦ ì‹¤íŒ¨ (HTTP ${res.status})\n${text}`;
      }
    } catch (err) {
      resultDiv.textContent = `ğŸš¨ ìš”ì²­ ì‹¤íŒ¨: ${err.message}`;
    }
  }
</script>
</body>
</html>
